---
title: "×”×¤×—×ª×ª ×©×’×™××•×ª ×§×¨×™××” ×¢×‘×•×¨ ×”-Sampler primitive ×‘×××¦×¢×•×ª M3"
sidebar_label: "×”×¤×—×ª×ª ×©×’×™××•×ª ×§×¨×™××” ×¢×‘×•×¨ ×”-Sampler primitive ×‘×××¦×¢×•×ª M3"
description: "×©×™××•×© ×‘×ª×•×¡×£ ×”-M3 ×œ×”×¤×—×ª×ª ×©×’×™××•×ª ×§×¨×™××” ×¢× ×”-Sampler primitive"
notebook_path: "docs/tutorials/readout-error-mitigation-sampler.ipynb"
---

<OpenInLabBanner notebookPath="docs/tutorials/readout-error-mitigation-sampler.ipynb" />



{/* cspell:ignore braket, Zgrm, newcommand, probs, quasis, topten */}

*××•××“×Ÿ ×©×™××•×©: ×¤×—×•×ª ××“×§×” ×¢×œ ××¢×‘×“ Heron r2 (×”×¢×¨×”: ×–×”×• ××•××“×Ÿ ×‘×œ×‘×“. ×–××Ÿ ×”×¨×™×¦×” ×‘×¤×•×¢×œ ×¢×©×•×™ ×œ×”×©×ª× ×•×ª.)*

## ×¨×§×¢ {#background}

×‘×©×•× ×” ××”-Estimator primitive, ×œ-Sampler primitive ××™×Ÿ ×ª××™×›×” ××•×‘× ×™×ª ×‘×”×¤×—×ª×ª ×©×’×™××•×ª.
××¡×¤×¨ ××”×©×™×˜×•×ª ×”× ×ª××›×•×ª ×¢×œ ×™×“×™ ×”-Estimator ××™×•×¢×“×•×ª ×‘××™×•×—×“ ×œ×¢×¨×›×™ ×¦×™×¤×™×™×”, ×•×œ×›×Ÿ ××™× ×Ÿ ×™×©×™××•×ª ×œ-Sampler primitive. ×™×•×¦× ×“×•×¤×Ÿ ×”×•× ×”×¤×—×ª×ª ×©×’×™××•×ª ×§×¨×™××”, ×©×”×™× ×©×™×˜×” ×™×¢×™×œ×” ×××•×“ ×”×™×©×™××” ×’× ×œ-Sampler primitive.

[×ª×•×¡×£ ×”-M3 ×©×œ Qiskit](https://qiskit.github.io/qiskit-addon-mthree/) ××××© ×©×™×˜×” ×™×¢×™×œ×” ×œ×”×¤×—×ª×ª ×©×’×™××•×ª ×§×¨×™××”. ××“×¨×™×š ×–×” ××¡×‘×™×¨ ×›×™×¦×“ ×œ×”×©×ª××© ×‘×ª×•×¡×£ M3 ×©×œ Qiskit ×œ×”×¤×—×ª×ª ×©×’×™××•×ª ×§×¨×™××” ×¢×‘×•×¨ ×”-Sampler primitive.

### ××”×™ ×©×’×™××ª ×§×¨×™××”? {#what-is-readout-error}

××™×“ ×œ×¤× ×™ ×”××“×™×“×”, ××¦×‘ ×¨×©×•××ª ×”-Qubit ××ª×•××¨
×¢×œ ×™×“×™ ×¡×•×¤×¨×¤×•×–×™×¦×™×” ×©×œ ××¦×‘×™ ×”×‘×¡×™×¡ ×”×—×™×©×•×‘×™,
××• ×¢×œ ×™×“×™ ××˜×¨×™×¦×ª ×¦×¤×™×¤×•×ª.
××“×™×“×ª ×¨×©×•××ª ×”-Qubit ×œ×ª×•×š ×¨×©×•××ª ×‘×™×˜×™× ×§×œ××¡×™×ª ××ª×‘×¦×¢×ª ×‘×©× ×™ ×©×œ×‘×™×.
×ª×—×™×œ×” ××ª×‘×¦×¢×ª ×”××“×™×“×” ×”×§×•×•× ×˜×™×ª ×¢×¦××”.
××©××¢×•×ª ×”×“×‘×¨ ×”×™× ×©××¦×‘ ×¨×©×•××ª ×”-Qubit
××•×§×¨×Ÿ ×¢×œ ××¦×‘ ×‘×¡×™×¡ ×™×—×™×“ ×”×××•×¤×™×™×Ÿ
×¢×œ ×™×“×™ ××—×¨×•×–×ª ×©×œ $1$×™× ×•-$0$×™×.
×”×©×œ×‘ ×”×©× ×™ ××•×¨×›×‘ ××§×¨×™××ª ××—×¨×•×–×ª ×”×‘×™×˜×™× ×”×××¤×™×™× ×ª ××¦×‘ ×‘×¡×™×¡ ×–×”
×•×›×ª×™×‘×ª×” ×œ×–×™×›×¨×•×Ÿ ×”××—×©×‘ ×”×§×œ××¡×™.
×× ×• ××›× ×™× ×©×œ×‘ ×–×” *×§×¨×™××”*.
××¡×ª×‘×¨ ×©×”×©×œ×‘ ×”×©× ×™ (×”×§×¨×™××”) ×’×•×¨× ×œ×™×•×ª×¨ ×©×’×™××•×ª ××”×©×œ×‘ ×”×¨××©×•×Ÿ (×”×”×§×¨× ×” ×¢×œ ××¦×‘×™ ×”×‘×¡×™×¡).
×”×“×‘×¨ ××•×‘×Ÿ ×›××©×¨ ×–×•×›×¨×™× ×©×”×§×¨×™××” ×“×•×¨×©×ª ×–×™×”×•×™ ××¦×‘ ×§×•×•× ×˜×™ ××™×§×¨×•×¡×§×•×¤×™
×•×”×’×‘×¨×ª×• ×œ×××“ ×”××§×¨×•×¡×§×•×¤×™. ×¨×–×•× × ×˜×•×¨ ×§×¨×™××” ××¦×•××“ ××œ ×”-Qubit
(××¡×•×’ transmon), ×•×¢×œ ×›×Ÿ ×—×•×•×” ×ª×–×•×–×ª ×ª×“×¨ ×§×˜× ×” ×××•×“. ×¤×•×œ×¡ ××™×§×¨×•×’×œ
× ×©×œ×— ×•××•×—×–×¨ ××”×¨×–×•× × ×˜×•×¨, ×•×‘×ª×•×¨×• ×—×•×•×” ×©×™× ×•×™×™× ×§×˜× ×™×
×‘×××¤×™×™× ×™×•. ×”×¤×•×œ×¡ ×”××•×—×–×¨ ××•×’×‘×¨ ×•×× ×•×ª×—. ×–×”×• ×ª×”×œ×™×š ×¢×“×™×Ÿ
×”× ×ª×•×Ÿ ×œ×©×•×¨×” ×©×œ ×©×’×™××•×ª.

×”× ×§×•×“×” ×”×—×©×•×‘×” ×”×™× ×©×‘×¢×•×“ ×©×©×ª×™ ×”××“×™×“×” ×”×§×•×•× ×˜×™×ª ×•×”×§×¨×™××” ×›×¤×•×¤×•×ª ×œ×©×’×™××•×ª, ×”××—×¨×•× ×”
×”×™× ×©×’×•×¨××ª ×œ×©×’×™××” ×”×“×•××™× × ×˜×™×ª, ×”× ×§×¨××ª ×©×’×™××ª ×§×¨×™××”, ×©×”×™× ××•×§×“ ×”××“×¨×™×š ×”×–×”.
### ×¨×§×¢ ×ª×™××•×¨×˜×™ {#theoretical-background}

×× ××—×¨×•×–×ª ×”×‘×™×˜×™× ×”×“×’×•××” (×”×××•×—×¡× ×ª ×‘×–×™×›×¨×•×Ÿ ×”×§×œ××¡×™) ×©×•× ×” ×××—×¨×•×–×ª ×”×‘×™×˜×™× ×”×××¤×™×™× ×ª
××ª ×”××¦×‘ ×”×§×•×•× ×˜×™ ×”××•×§×¨×Ÿ, ×× ×• ××•××¨×™× ×©××™×¨×¢×” ×©×’×™××ª ×§×¨×™××”.
×©×’×™××•×ª ××œ×• × ×¦×¤×•×ª ×›××§×¨××™×•×ª ×•×œ×œ× ××ª×× ××“×’× ×œ×“×’×.
×”×•×›×— ×›×™ ××•×¢×™×œ ×œ××“×œ ××ª ×©×’×™××ª ×”×§×¨×™××” ×›_×¢×¨×•×¥ ×§×œ××¡×™ ×¨×•×¢×©_.
×›×œ×•××¨, ×¢×‘×•×¨ ×›×œ ×–×•×’
××—×¨×•×–×•×ª ×‘×™×˜×™× $i$ ×•-$j$, ×§×™×™××ª ×”×¡×ª×‘×¨×•×ª ×§×‘×•×¢×” ×©×¢×¨×š ×××™×ª×™ ×©×œ $j$ ×™×™×§×¨×
×‘×˜×¢×•×ª ×›-$i$.

×‘×™×ª×¨ ×“×™×•×§, ×¢×‘×•×¨ ×›×œ ×–×•×’ ××—×¨×•×–×•×ª ×‘×™×˜×™× $(i, j)$, ×§×™×™××ª ×”×¡×ª×‘×¨×•×ª (××•×ª× ×™×ª) ${M}_{i,j}$
×©-$i$ × ×§×¨×, ×‘×”×™× ×ª×Ÿ ×©×”×¢×¨×š ×”×××™×ª×™ ×”×•× $j.$
×›×œ×•××¨,
$$
    {M}_{i,j} =  \Pr(\text{readout value is } i | \text{true value is } j)
    \text{ for } i,j \in (0,...,2^n - 1), \tag{1}
$$
×›××©×¨ $n$ ×”×•× ××¡×¤×¨ ×”×‘×™×˜×™× ×‘×¨×©×•××ª ×”×§×¨×™××”.
×œ×©× ×”×‘×”×¨×”, ×× ×• ×× ×™×—×™× ×©-$i$ ×”×•× ××¡×¤×¨ ×©×œ× ×¢×©×¨×•× ×™ ×©×™×™×¦×•×’×• ×”×‘×™× ××¨×™ ×”×•×
××—×¨×•×–×ª ×”×‘×™×˜×™× ×”××ª×™×™×’×ª ××ª ××¦×‘×™ ×”×‘×¡×™×¡ ×”×—×™×©×•×‘×™.
×× ×• ××›× ×™× ××ª ×”××˜×¨×™×¦×” ${M}$ ×‘×’×•×“×œ $2^n \times 2^n$ _××˜×¨×™×¦×ª ×”×”×©××”_.
×¢×‘×•×¨ ×¢×¨×š ×××™×ª×™ ×§×‘×•×¢ $j$, ×¡×›×•× ×”×”×¡×ª×‘×¨×•×™×•×ª ×¢×œ ×›×œ ×”×ª×•×¦××•×ª ×”×¨×•×¢×©×•×ª $i$ ×—×™×™×‘ ×œ×”×™×•×ª $1$. ×›×œ×•××¨
$$
    \sum_{i=0}^{2^n - 1} {M}_{i,j} = 1 \text{ for all } j
$$
××˜×¨×™×¦×” ×œ×œ× ×¢×¨×›×™× ×©×œ×™×œ×™×™× ×”××§×™×™××ª (1) × ×§×¨××ª
_×¡×˜×•×›×¡×˜×™×ª-×©×××œ×™×ª_.
××˜×¨×™×¦×” ×¡×˜×•×›×¡×˜×™×ª-×©×××œ×™×ª × ×§×¨××ª ×’× _×¡×˜×•×›×¡×˜×™×ª-×¢××•×“×”_ ×××—×¨ ×©×›×œ ××—×ª ××¢××•×“×•×ª×™×” ××¡×ª×›××ª ×œ-$1$.
×× ×• ×§×•×‘×¢×™× ×‘× ×™×¡×•×™ ×¢×¨×›×™× ××©×•×¢×¨×™× ×œ×›×œ ××™×‘×¨ ${M}_{i,j}$ ×¢×œ ×™×“×™
×”×›× ×” ×—×•×–×¨×ª ×©×œ ×›×œ ××¦×‘ ×‘×¡×™×¡ $|j \rangle$ ×•×œ××—×¨ ××›×Ÿ ×—×™×©×•×‘ ×”×ª×“×™×¨×•×™×•×ª
×©×œ ×”×ª×¨×—×©×•×ª ××—×¨×•×–×•×ª ×”×‘×™×˜×™× ×”×“×’×•××•×ª.

×× × ×™×¡×•×™ ×›×•×œ×œ ×××™×“×ª ×”×ª×¤×œ×’×•×ª ×”×¡×ª×‘×¨×•×ª ×¢×œ ××—×¨×•×–×•×ª ×‘×™×˜×™× ×¤×œ×˜ ×‘×××¦×¢×•×ª ×“×’×™××” ×—×•×–×¨×ª,
××– × ×•×›×œ ×œ×”×©×ª××© ×‘-${M}$ ×œ×”×¤×—×ª×ª ×©×’×™××•×ª ×§×¨×™××” ×‘×¨××ª ×”×”×ª×¤×œ×’×•×ª.
×”×¦×¢×“ ×”×¨××©×•×Ÿ ×”×•× ×œ×”×¨×™×¥ ××¢×’×œ ×§×‘×•×¢ ×”××¢× ×™×™×Ÿ ××•×ª× ×• ×¤×¢××™× ×¨×‘×•×ª,
×•×œ×™×¦×•×¨ ×”×™×¡×˜×•×’×¨××” ×©×œ ××—×¨×•×–×•×ª ×‘×™×˜×™× ×“×’×•××•×ª.
×”×”×™×¡×˜×•×’×¨××” ×”×× ×•×¨××œ×ª ×”×™× ×”×ª×¤×œ×’×•×ª ×”×”×¡×ª×‘×¨×•×ª ×”× ××“×“×ª ×¢×œ
$2^n$ ××—×¨×•×–×•×ª ×”×‘×™×˜×™× ×”××¤×©×¨×™×•×ª, ×©×× ×• ××¡×× ×™× ××•×ª×” ×‘-${\tilde{p}} \in \mathbb{R}^{2^n}$.
×”×”×¡×ª×‘×¨×•×ª (×”××©×•×¢×¨×ª) ${{\tilde{p}}}_i$ ×œ×“×’×™××ª ××—×¨×•×–×ª ×”×‘×™×˜×™× $i$
×©×•×•×” ×œ×¡×›×•× ×¢×œ ×›×œ ××—×¨×•×–×•×ª ×”×‘×™×˜×™× ×”×××™×ª×™×•×ª $j$, ×›×œ ××—×ª ××©×•×§×œ×œ×ª ×œ×¤×™
×”×”×¡×ª×‘×¨×•×ª ×©×”×™× ×ª×ª×¤×¨×© ×‘×˜×¢×•×ª ×›-$i$.
×”×¦×”×¨×” ×–×• ×‘×¦×•×¨×” ××˜×¨×™×¦×™××œ×™×ª ×”×™×
$$
    {\tilde{p}} = {M} {\vec{p}}, \tag{2},
$$
×›××©×¨ ${\vec{p}}$ ×”×™× ×”×”×ª×¤×œ×’×•×ª ×”×××™×ª×™×ª. ×‘××™×œ×™× ××—×¨×•×ª, ×œ×©×’×™××ª ×”×§×¨×™××” ×™×© ×”×©×¤×¢×” ×©×œ ×”×›×¤×œ×ª
×”×”×ª×¤×œ×’×•×ª ×”××™×“×™××œ×™×ª ×¢×œ ××—×¨×•×–×•×ª ×”×‘×™×˜×™× ${\vec{p}}$ ×‘××˜×¨×™×¦×ª ×”×”×©××” ${M}$
×œ×™×™×¦×•×¨ ×”×”×ª×¤×œ×’×•×ª ×”× ×¦×¤×™×ª ${\tilde{p}}$.
××“×“× ×• ××ª ${\tilde{p}}$ ×•××ª ${M}$, ××š ××™×Ÿ ×œ× ×• ×’×™×©×” ×™×©×™×¨×” ×œ-${\vec{p}}$. ×‘××•×¤×Ÿ ×¢×§×¨×•× ×™, × ×§×‘×œ
××ª ×”×”×ª×¤×œ×’×•×ª ×”×××™×ª×™×ª ×©×œ ××—×¨×•×–×•×ª ×”×‘×™×˜×™× ×¢×‘×•×¨ ×”××¢×’×œ ×©×œ× ×•
×¢×œ ×™×“×™ ×¤×ª×¨×•×Ÿ ××©×•×•××” (2) ×¢×‘×•×¨ ${\vec{p}}$ ×‘××•×¤×Ÿ × ×•××¨×™.

×œ×¤× ×™ ×©× ××©×™×š, ×›×“××™ ×œ×¦×™×™×Ÿ ×›××” ×ª×›×•× ×•×ª ×—×©×•×‘×•×ª ×©×œ ×’×™×©×” × ××™×‘×™×ª ×–×•.

- ×‘×¤×•×¢×œ, ××©×•×•××” (2) ××™× ×” × ×¤×ª×¨×ª ×¢×œ ×™×“×™ ×”×™×¤×•×š ${M}$. ×©×’×¨×•×ª
  ××œ×’×‘×¨×” ×œ×™× ××¨×™×ª ×‘×¡×¤×¨×™×•×ª ×ª×•×›× ×” ××©×ª××©×•×ª ×‘×©×™×˜×•×ª ×™×¦×™×‘×•×ª, ××“×•×™×§×•×ª ×•×™×¢×™×œ×•×ª ×™×•×ª×¨.
- ×‘×¢×ª ×××™×“×ª ${M}$, ×”× ×—× ×• ×©××™×¨×¢×• ×¨×§ ×©×’×™××•×ª ×§×¨×™××”. ×‘×¤×¨×˜,
  ×”× ×—× ×• ×©×œ× ×”×™×• ×©×’×™××•×ª ×”×›× ×ª ××¦×‘ ×•××“×™×“×” ×§×•×•× ×˜×™×ª â€”
  ××• ×œ×¤×—×•×ª ×©×”×Ÿ ×”×•×¤×—×ª×• ×‘×“×¨×›×™× ××—×¨×•×ª.
  ×‘××™×“×” ×©×”× ×—×” ×–×• ×˜×•×‘×”, ${M}$ ××™×™×¦×’×ª
  ×¨×§ ×©×’×™××ª ×§×¨×™××”. ××š ×›××©×¨ ×× ×• _××©×ª××©×™×_ ×‘-${M}$ ×œ×ª×™×§×•×Ÿ ×”×ª×¤×œ×’×•×ª × ××“×“×ª
  ×¢×œ ××—×¨×•×–×•×ª ×‘×™×˜×™×, ××™×Ÿ ×× ×• ×¢×•×©×™× ×”× ×—×” ×›×–×•. ×œ××¢×©×”, ×× ×• ××¦×¤×™× ×©××¢×’×œ ××¢× ×™×™×Ÿ
  ×™×›× ×™×¡ ×¨×¢×©, ×œ××©×œ ×©×’×™××•×ª Gate. ×”×”×ª×¤×œ×’×•×ª "×”×××™×ª×™×ª"
  ×¢×“×™×™×Ÿ ×›×•×œ×œ×ª ×”×©×¤×¢×•×ª ××›×œ ×©×’×™××•×ª ×©×œ× ×”×•×¤×—×ª×• ×‘×“×¨×›×™× ××—×¨×•×ª.

×©×™×˜×” ×–×•, ××£ ×©×”×™× ×©×™××•×©×™×ª ×‘× ×¡×™×‘×•×ª ××¡×•×™××•×ª, ×¡×•×‘×œ×ª ×××¡×¤×¨ ××’×‘×œ×•×ª.

××©××‘×™ ×”××¨×—×‘ ×•×”×–××Ÿ ×”×“×¨×•×©×™× ×œ×××™×“×ª ${M}$ ×’×“×œ×™× ×‘××•×¤×Ÿ ××§×¡×¤×•× × ×¦×™××œ×™ ×‘-$n$:
- ×”×××™×“×” ×©×œ ${M}$ ×•-${\tilde{p}}$ ×›×¤×•×¤×” ×œ×©×’×™××” ×¡×˜×˜×™×¡×˜×™×ª ×¢×§×‘ ×“×’×™××” ×¡×•×¤×™×ª.
  ×¨×¢×© ×–×” ×™×›×•×œ ×œ×”×™×•×ª ×§×˜×Ÿ ×›×¨×¦×•×™
  ×¢×œ ×—×©×‘×•×Ÿ ×™×¨×™×•×ª × ×•×¡×¤×•×ª (×¢×“ ×œ×¡×§××œ×ª ×”×–××Ÿ ×©×œ ×©×™× ×•×™ ×¤×¨××˜×¨×™ ×—×•××¨×”
  ×”×’×•×¨××™× ×œ×©×’×™××•×ª ×©×™×˜×ª×™×•×ª ×‘-${M}$).
  ××•×œ×, ×× ××™×Ÿ ×”× ×—×•×ª ×œ×’×‘×™ ××—×¨×•×–×•×ª ×”×‘×™×˜×™× ×©× ×¦×¤×•×ª
  ×‘×¢×ª ×‘×™×¦×•×¢ ×”×”×¤×—×ª×”, ××¡×¤×¨ ×”×™×¨×™×•×ª ×”×“×¨×•×© ×œ×××™×“×ª ${M}$ ×’×“×œ
  ×œ×¤×—×•×ª ××§×¡×¤×•× × ×¦×™××œ×™×ª ×‘-$n$.
- ${M}$ ×”×™× ××˜×¨×™×¦×” ×‘×’×•×“×œ $2^n \times 2^n$.
  ×›××©×¨ $n>10$, ×›××•×ª ×”×–×™×›×¨×•×Ÿ ×”×“×¨×•×©×” ×œ××—×¡×•×Ÿ ${M}$
  ×’×“×•×œ×” ××”×–×™×›×¨×•×Ÿ ×”×–××™×Ÿ ×‘××—×©×‘ × ×™×™×“ ×¨×‘-×¢×•×¦××”.

××’×‘×œ×•×ª × ×•×¡×¤×•×ª ×”×Ÿ:

- ×”×”×ª×¤×œ×’×•×ª ×”××©×•×—×–×¨×ª ${\vec{p}}$ ×¢×©×•×™×” ×œ×›×œ×•×œ ×”×¡×ª×‘×¨×•×ª ×©×œ×™×œ×™×ª ××—×ª
  ××• ×™×•×ª×¨ (×ª×•×š ×›×“×™ ×¡×›×™××” ×œ××—×“). ×¤×ª×¨×•×Ÿ ××—×“
  ×”×•× ×œ××–×¢×¨ ××ª $||{M} {\vec{p}} - {\tilde{p}}||^2$ ×‘×›×¤×•×£ ×œ××™×œ×•×¥ ×©×›×œ
  ×¢×¨×š ×‘-${\vec{p}}$ ×™×”×™×” ××™-×©×œ×™×œ×™. ×¢× ×–××ª, ×–××Ÿ ×”×¨×™×¦×” ×©×œ ×©×™×˜×” ×›×–×•
  ××¨×•×š ×‘×¡×“×¨×™ ×’×•×“×œ ×××©×¨ ×¤×ª×¨×•×Ÿ ×™×©×™×¨ ×©×œ ××©×•×•××” (2).
- ×”×œ×™×š ×”×¤×—×ª×” ×–×” ×¤×•×¢×œ ×‘×¨××ª ×”×ª×¤×œ×’×•×ª ×”×¡×ª×‘×¨×•×ª
  ×¢×œ ××—×¨×•×–×•×ª ×‘×™×˜×™×. ×‘×¤×¨×˜, ×”×•× ××™× ×• ×™×›×•×œ ×œ×ª×§×Ÿ ×©×’×™××” ×‘××—×¨×•×–×ª ×‘×™×˜×™×
  ×‘×•×“×“×ª ×©× ×¦×¤×ª×”.
### ×ª×•×¡×£ ×”-M3 ×©×œ Qiskit: ×”×ª×××” ×œ××—×¨×•×–×•×ª ×‘×™×˜×™× ××¨×•×›×•×ª ×™×•×ª×¨ {#qiskit-m3-addon-scaling-to-longer-bitstrings}

×¤×ª×¨×•×Ÿ ××©×•×•××” (2) ×‘×××¦×¢×•×ª ×©×’×¨×•×ª ××œ×’×‘×¨×” ×œ×™× ××¨×™×ª × ×•××¨×™×ª ×¡×˜× ×“×¨×˜×™×•×ª ××•×’×‘×œ ×œ××—×¨×•×–×•×ª ×‘×™×˜×™× ×©××™× ×Ÿ ××¨×•×›×•×ª ××›-10 ×‘×™×˜×™×. ××•×œ× M3 ××¡×•×’×œ ×œ×˜×¤×œ ×‘××—×¨×•×–×•×ª ×‘×™×˜×™× ××¨×•×›×•×ª ×”×¨×‘×” ×™×•×ª×¨. ×©×ª×™ ×ª×›×•× ×•×ª ××¤×ª×— ×©×œ M3 ×”×××¤×©×¨×•×ª ×–××ª ×”×Ÿ:
- ××ª×××™× ×‘×©×’×™××ª ×§×¨×™××” ××¡×“×¨ ×©×œ×•×© ×•××¢×œ×” ×‘×™×Ÿ ××•×¡×¤×™ ×‘×™×˜×™×
  ×× ×™×—×™× ×©×”× ×–× ×™×—×™× ×•××ª×¢×œ××™× ××”×. ×‘××•×¤×Ÿ ×¢×§×¨×•× ×™, ×‘××—×™×¨ ×©×œ ×™×¨×™×•×ª × ×•×¡×¤×•×ª,
  × ×™×ª×Ÿ ×œ×××•×“ ××ª×××™× ×’×‘×•×”×™× ×™×•×ª×¨ ×’× ×›×Ÿ.
- ×‘××§×•× ×œ×‘× ×•×ª ××ª ${M}$ ×‘××•×¤×Ÿ ××¤×•×¨×©, ×× ×• ××©×ª××©×™× ×‘××˜×¨×™×¦×” ×™×¢×™×œ×” ×§×˜× ×” ×‘×”×¨×‘×” ×©××ª×¢×“×ª
  ×”×¡×ª×‘×¨×•×™×•×ª ×¨×§ ×¢×‘×•×¨ ××—×¨×•×–×•×ª ×‘×™×˜×™× ×©× ××¡×¤×• ×‘×¢×ª ×‘× ×™×™×ª ${\tilde{p}}$.

×‘×¨××” ×’×‘×•×”×”, ×”×”×œ×™×š ×¤×•×¢×œ ×›×“×œ×§××Ÿ.

×¨××©×™×ª, ×× ×• ×‘×•× ×™× ××‘× ×™ ×‘× ×™×™×Ÿ ×©××”×Ÿ × ×™×ª×Ÿ ×œ×‘× ×•×ª ×ª×™××•×¨ ×™×¢×™×œ ×•××¤×•×©×˜ ×©×œ ${M}$.
×œ××—×¨ ××›×Ÿ, ×× ×• ××¨×™×¦×™× ×©×•×‘ ×•×©×•×‘ ××ª ×”××¢×’×œ ×”××¢× ×™×™×Ÿ ×•××•×¡×¤×™× ××—×¨×•×–×•×ª ×‘×™×˜×™× ×©××©××©×•×ª ×œ×‘× ×™×™×ª
×”×Ÿ ${\tilde{p}}$ ×•×”×Ÿ, ×‘×¢×–×¨×ª ××‘× ×™ ×”×‘× ×™×™×Ÿ, ${M}$ ×™×¢×™×œ×”.

×‘×™×ª×¨ ×“×™×•×§,
- ××˜×¨×™×¦×•×ª ×”×©××” ×©×œ Qubit ×™×—×™×“ ×××•××“×•×ª ×¢×‘×•×¨ ×›×œ Qubit. ×œ×©× ×›×š, ×× ×• ××›×™× ×™× ×©×•×‘ ×•×©×•×‘
  ××ª ×¨×©×•××ª ×”-Qubit ×‘××¦×‘ ×”××¤×¡×™× ×”×›×•×œ×œ $|0 ... 0 \rangle$ ×•××– ×‘××¦×‘ ×”××—×“×•×ª ×”×›×•×œ×œ
  $|1 ... 1 \rangle$, ×•××ª×¢×“×™× ××ª ×”×”×¡×ª×‘×¨×•×ª ×¢×‘×•×¨ ×›×œ Qubit ×©× ×§×¨×
  ×‘×˜×¢×•×ª.
- ××ª×××™× ××¡×“×¨ ×©×œ×•×© ×•××¢×œ×” ×× ×™×—×™× ×©×”× ×–× ×™×—×™× ×•××ª×¢×œ××™× ××”×.

  ×‘××§×•× ×–××ª ×× ×• ×‘×•× ×™× $n$ ××˜×¨×™×¦×•×ª ×”×©××” ×©×œ Qubit ×™×—×™×“ ×‘×’×•×“×œ $2 \times 2$,
  ×•-$n(n-1)/2$ ××˜×¨×™×¦×•×ª ×”×©××” ×©×œ ×©× ×™ Qubit ×‘×’×•×“×œ $4 \times 4$. ××˜×¨×™×¦×•×ª ×”-Qubit ×”×™×—×™×“
  ×•×©× ×™ ×”-Qubit ×”×œ×œ×• ×××•×—×¡× ×•×ª ×œ×©×™××•×© ×××•×—×¨ ×™×•×ª×¨.
- ×œ××—×¨ ×“×’×™××” ×—×•×–×¨×ª ×©×œ ××¢×’×œ ×œ×‘× ×™×™×ª ${\tilde{p}}$,
  ×× ×• ×‘×•× ×™× ×§×™×¨×•×‘ ×™×¢×™×œ ×œ-${M}$ ×ª×•×š ×©×™××•×© ×¨×§
  ×‘××—×¨×•×–×•×ª ×‘×™×˜×™× ×©× ×“×’××• ×‘×¢×ª ×‘× ×™×™×ª ${\tilde{p}}$. ××˜×¨×™×¦×” ×™×¢×™×œ×” ×–×•
  × ×‘× ×™×ª ×‘×××¦×¢×•×ª ××˜×¨×™×¦×•×ª ×”-Qubit ×”×™×—×™×“ ×•×©× ×™ ×”-Qubit ×”××•×–×›×¨×•×ª ×‘×¡×¢×™×£ ×”×§×•×“×.
  ×”×××“ ×”×œ×™× ××¨×™ ×©×œ ××˜×¨×™×¦×” ×–×• ×”×•× ×œ×›×œ ×”×™×•×ª×¨ ××¡×“×¨ ×’×•×“×œ ××¡×¤×¨
  ×”×™×¨×™×•×ª ×©× ×¢×©×” ×‘×”×Ÿ ×©×™××•×© ×‘×‘× ×™×™×ª ${\tilde{p}}$, ×©×”×•× ×§×˜×Ÿ ×‘×”×¨×‘×” ××”×××“
  $2^n$ ×©×œ ××˜×¨×™×¦×ª ×”×”×©××” ×”××œ××” ${M}$.

×œ×¤×¨×˜×™× ×˜×›× ×™×™× ×¢×œ M3, × ×™×ª×Ÿ ×œ×¢×™×™×Ÿ ×‘-[*Scalable Mitigation of Measurement Errors on Quantum Computers*](https://journals.aps.org/prxquantum/abstract/10.1103/PRXQuantum.2.040326).
### ×™×™×©×•× M3 ×¢×œ ××œ×’×•×¨×™×ª× ×§×•×•× ×˜×™ {#application-of-m3-to-a-quantum-algorithm}
× ×™×©× ××ª ×”×¤×—×ª×ª ×©×’×™××•×ª ×”×§×¨×™××” ×©×œ M3 ×¢×œ ×‘×¢×™×™×ª ×”×”×–×–×” ×”× ×¡×ª×¨×ª. ×‘×¢×™×™×ª ×”×”×–×–×” ×”× ×¡×ª×¨×ª, ×•×‘×¢×™×•×ª ×§×©×•×¨×•×ª ×›×’×•×Ÿ [×‘×¢×™×™×ª ×ª×ª-×”×§×‘×•×¦×” ×”× ×¡×ª×¨×ª](https://en.wikipedia.org/wiki/Hidden_subgroup_problem), × ×•×¦×¨×• ×‘××§×•×¨ ×‘×”×§×©×¨ ×©×œ ×¡×‘×™×‘×” ×¢××™×“×” ×œ×ª×§×œ×•×ª (×‘×™×ª×¨ ×“×™×•×§, ×œ×¤× ×™ ×©×”×•×›×— ×©××—×©×‘×™× ×§×•×•× ×˜×™×™× ×¢××™×“×™× ×œ×ª×§×œ×•×ª ××¤×©×¨×™×™×!). ××š ×”×Ÿ × ×—×§×¨×•×ª ×’× ×¢× ××¢×‘×“×™× ×–××™× ×™×. ×“×•×’××” ×œ××¦×ª ××”×™×¨×•×ª ××œ×’×•×¨×™×ª××™×ª ××§×¡×¤×•× × ×¦×™××œ×™×ª ×©×”×•×©×’×” ×œ×’×¨×¡×” ×©×œ ×‘×¢×™×™×ª ×”×”×–×–×” ×”× ×¡×ª×¨×ª ×¢×œ ××—×©×‘×™ IBM&reg; QPUs ×‘× ×™ 127 Qubit × ×™×ª×Ÿ ×œ××¦×•× ×‘[××××¨ ×–×”](https://journals.aps.org/prx/accepted/a9074K06A8e1590147da9c69f8c4b64c28247be5a) ([×’×¨×¡×ª arXiv](https://arxiv.org/abs/2401.07934)).

×‘×”××©×š, ×›×œ ×”××¨×™×ª××˜×™×§×” ×”×™× ×‘×•×œ×™×× ×™×ª.
×›×œ×•××¨, ×¢×‘×•×¨ $a, b \in \mathbb{Z}_2 = \{0, 1\}$, ×—×™×‘×•×¨ $a + b$ ×”×•× ×¤×•× ×§×¦×™×™×ª ×”-XOR ×”×œ×•×’×™×ª.
×™×ª×¨ ×¢×œ ×›×Ÿ, ×›×¤×œ $a \times b$ (××• $a b$) ×”×•× ×¤×•× ×§×¦×™×™×ª ×”-AND ×”×œ×•×’×™×ª. ×¢×‘×•×¨ $x, y \in \{0, 1\}^n$,
$x + y$ ××•×’×“×¨ ×¢×œ ×™×“×™ ×™×™×©×•× ×‘×™×˜×™ ×©×œ XOR.
××›×¤×œ×” ×”×¤× ×™××™×ª $\cdot: {\mathbb{Z}_2^n} \rightarrow \mathbb{Z}_2$ ××•×’×“×¨×ª
×¢×œ ×™×“×™ $x \cdot y = \sum_i x_i y_i$.
#### ××•×¤×¨×˜×•×¨ ×”-Hadamard ×•×”×ª××¨×ª ×¤×•×¨×™×™×” {#hadamard-operator-and-fourier-transform}

×‘×™×™×©×•× ××œ×’×•×¨×™×ª××™× ×§×•×•× ×˜×™×™×, × ×¤×•×¥ ×××•×“ ×œ×”×©×ª××© ×‘××•×¤×¨×˜×•×¨ ×”-Hadamard ×›×ª××¨×ª ×¤×•×¨×™×™×”.
××¦×‘×™ ×”×‘×¡×™×¡ ×”×—×™×©×•×‘×™ × ×§×¨××™× ×œ×¢×ª×™× _××¦×‘×™× ×§×œ××¡×™×™×_. ×”× ×¢×•××“×™× ×‘
×™×—×¡ ×—×“-×—×“-×¢×¨×›×™ ×œ××—×¨×•×–×•×ª ×”×‘×™×˜×™× ×”×§×œ××¡×™×•×ª.
××•×¤×¨×˜×•×¨ ×”-Hadamard ×©×œ $n$ Qubit ×¢×œ ××¦×‘×™× ×§×œ××¡×™×™× × ×™×ª×Ÿ ×œ×¨××•×ª ×›×ª××¨×ª ×¤×•×¨×™×™×” ×¢×œ ×”-hypercube ×”×‘×•×œ×™×× ×™:
$$
H^{\otimes n} =  \frac{1}{\sqrt{2^n}} \sum_{x,y \in {\mathbb{Z}_2^n}} (-1)^{x \cdot y} {|{y}\rangle}{\langle{x}|}.
$$
× ×©×§×•×œ ××¦×‘ ${|{s}\rangle}$ ×”××ª××™× ×œ××—×¨×•×–×ª ×‘×™×˜×™× ×§×‘×•×¢×” $s$.
×¢×œ ×™×“×™ ×™×™×©×•× $H^{\otimes n}$, ×•×©×™××•×© ×‘-${\langle {x}|{s}\rangle} = \delta_{x,s}$,
× ×¨××” ×©×ª××¨×ª ×¤×•×¨×™×™×” ×©×œ ${|{s}\rangle}$ × ×™×ª×Ÿ ×œ×›×ª×™×‘×” ×›-
$$
   H^{\otimes n} {|{s}\rangle} =  \frac{1}{\sqrt{2^n}} \sum_{y \in {\mathbb{Z}_2^n}} (-1)^{s \cdot y} {|{y}\rangle}.
$$

×”-Hadamard ×”×•× ×”×”×•×¤×›×™ ×©×œ ×¢×¦××•, ×›×œ×•××¨
 $H^{\otimes n} H^{\otimes n} = (H H)^{\otimes n} = I^{\otimes n}$.
×œ×›×Ÿ, ×ª××¨×ª ×”×¤×•×¨×™×™×” ×”×”×•×¤×›×™×ª ×”×™× ××•×ª×• ×”××•×¤×¨×˜×•×¨, $H^{\otimes n}$.
×‘××•×¤×Ÿ ××¤×•×¨×©, ×™×© ×œ× ×•,
$$
  {|{s}\rangle} =  H^{\otimes n} H^{\otimes n} {|{s}\rangle}  =  H^{\otimes n} \frac{1}{\sqrt{2^n}} \sum_{y \in {\mathbb{Z}_2^n}} (-1)^{s \cdot y} {|{y}\rangle}.
$$
#### ×‘×¢×™×™×ª ×”×”×–×–×” ×”× ×¡×ª×¨×ª {#the-hidden-shift-problem}

× ×©×§×•×œ ×“×•×’××” ×¤×©×•×˜×” ×©×œ _×‘×¢×™×™×ª ×”×–×–×” × ×¡×ª×¨×ª_.
×”×‘×¢×™×” ×”×™× ×œ×–×”×•×ª ×”×–×–×” ×§×‘×•×¢×” ×‘×§×œ×˜ ×œ×¤×•× ×§×¦×™×”.
×”×¤×•× ×§×¦×™×” ×©×× ×• ×©×•×§×œ×™× ×”×™× ×”××›×¤×œ×” ×”×¤× ×™××™×ª. ×”×™× ×”×—×‘×¨ ×”×¤×©×•×˜ ×‘×™×•×ª×¨
××ª×•×š ×§×‘×•×¦×” ×’×“×•×œ×” ×©×œ ×¤×•× ×§×¦×™×•×ª ×©×××¤×©×¨×•×ª ×”××¦×” ×§×•×•× ×˜×™×ª ×œ×‘×¢×™×™×ª ×”×”×–×–×” ×”× ×¡×ª×¨×ª
×‘×××¦×¢×•×ª ×˜×›× ×™×§×•×ª ×“×•××•×ª ×œ××œ×” ×”××•×¦×’×•×ª ×œ×”×œ×Ÿ.

×ª×”×™ $x,y \in {\mathbb{Z}_2^m}$ ××—×¨×•×–×•×ª ×‘×™×˜×™× ×‘××•×¨×š $m$.
× ×’×“×™×¨ ${f}: {\mathbb{Z}_2^m} \times {\mathbb{Z}_2^m} \rightarrow \{-1,1\}$ ×¢×œ ×™×“×™
$$
  {f}(x, y) = (-1)^{x \cdot y}.
$$
  ×ª×”×™ $a,b \in {\mathbb{Z}_2^m}$ ××—×¨×•×–×•×ª ×‘×™×˜×™× ×§×‘×•×¢×•×ª ×‘××•×¨×š $m$.
  ×× ×• ××’×“×™×¨×™× ×¢×•×“ $g: {\mathbb{Z}_2^m} \times {\mathbb{Z}_2^m} \rightarrow \{-1,1\}$ ×¢×œ ×™×“×™
$$
  g(x, y) = {f}(x+a, y+b) = (-1)^{(x+a) \cdot (y+b)},
  $$
  ×›××©×¨ $a$ ×•-$b$ ×”× ×¤×¨××˜×¨×™× (× ×¡×ª×¨×™×).
  × ×™×ª×Ÿ ×œ× ×• ×©×ª×™ ×§×•×¤×¡××•×ª ×©×—×•×¨×•×ª, ××—×ª ×××©×ª ××ª $f$, ×•×”×©× ×™×™×” ××ª $g$.
  ×× ×• ×× ×™×—×™× ×©×× ×• ×™×•×“×¢×™× ×©×”×Ÿ ××—×©×‘×•×ª ××ª ×”×¤×•× ×§×¦×™×•×ª ×”××•×’×“×¨×•×ª ×œ×¢×™×œ, ×¤×¨×˜ ×œ×›×š ×©××™× × ×• ×™×•×“×¢×™×
  ×œ× ××ª $a$ ×•×œ× ××ª $b$. ×”××©×—×§ ×”×•× ×œ×§×‘×•×¢ ××ª ××—×¨×•×–×•×ª ×”×‘×™×˜×™× ×”× ×¡×ª×¨×•×ª (×”×”×–×–×•×ª)
  $a$ ×•-$b$ ×¢×œ ×™×“×™ ×‘×™×¦×•×¢ ×©××™×œ×ª×•×ª ×œ-$f$ ×•×œ-$g$. ×‘×¨×•×¨ ×©×× × ×©×—×§ ××ª ×”××©×—×§ ×‘×¦×•×¨×” ×§×œ××¡×™×ª,
  × ×“×¨×©×•×ª $O(2m)$ ×©××™×œ×ª×•×ª ×œ×§×‘×™×¢×ª $a$ ×•-$b$. ×œ×“×•×’××”, × ×™×ª×Ÿ ×œ×©××•×œ ××ª $g$ ×¢× ×›×œ ×”×–×•×’×•×ª ×©×œ ××—×¨×•×–×•×ª ×›×š ×©××—×“ ×××™×‘×¨×™ ×”×–×•×’ ×”×•× ××¤×¡×™× ×‘×œ×‘×“, ×•×”××™×‘×¨ ×”××—×¨ ×›×•×œ×œ ×‘×“×™×•×§ ××—×“ ×©×•×•×” ×œ-$1$.
  ×‘×›×œ ×©××™×œ×ª×”, ×× ×• ×œ×•××“×™× ××™×‘×¨ ××—×“ ×-$a$ ××• ×-$b$.
  ××•×œ×, × ×¨××” ×©×× ×”×§×•×¤×¡××•×ª ×”×©×—×•×¨×•×ª ×××•××©×•×ª ×›××¢×’×œ×™ Circuit ×§×•×•× ×˜×™×™×, × ×•×›×œ
  ×œ×§×‘×•×¢ ××ª $a$ ×•-$b$ ×¢× ×©××™×œ×ª×” ×‘×•×“×“×ª ×œ×›×œ ××—×ª ×-$f$ ×•-$g$.

  ×‘×”×§×©×¨ ×©×œ ××•×¨×›×‘×•×ª ××œ×’×•×¨×™×ª××™×ª, ×§×•×¤×¡×” ×©×—×•×¨×” × ×§×¨××ª _××•×¨×§×œ_.
  ×‘× ×•×¡×£ ×œ××˜×™××•×ª×•, ×œ××•×¨×§×œ ×™×© ×ª×›×•× ×” ×©×”×•× ×¦×•×¨×š ××ª ×”×§×œ×˜ ×•
  ××™×™×¦×¨ ××ª ×”×¤×œ×˜ ×‘××•×¤×Ÿ ××™×™×“×™, ××‘×œ×™ ×œ×”×•×¡×™×£ ×“×‘×¨ ×œ×ª×§×¦×™×‘ ×”××•×¨×›×‘×•×ª ×©×œ ×”××œ×’×•×¨×™×ª×
  ×©×‘×• ×”×•× ××©×•×‘×¥. ×œ××¢×©×”, ×‘××§×¨×” ×©×œ× ×•, ×”××•×¨×§×œ×™× ×”×××©×™× ××ª $f$ ×•-
  $g$ ×™×ª×’×œ×• ×›×™×¢×™×œ×™×.
#### ××¢×’×œ×™ Circuit ×¢×‘×•×¨ $f$ ×•-$g$ {#quantum-circuits-for-f-and-g}

×× ×• ×–×§×•×§×™× ×œ×¨×›×™×‘×™× ×”×‘××™× ×›×“×™ ×œ×××© ××ª $f$ ×•-$g$ ×›××¢×’×œ×™ Circuit ×§×•×•× ×˜×™×™×.

×¢×‘×•×¨ ××¦×‘×™× ×§×œ××¡×™×™× ×©×œ Qubit ×™×—×™×“ ${|{x_1}\rangle}, {|{y_1}\rangle}$, ×¢× $x_1,y_1 \in \mathbb{Z}_2$,
×”-Gate ×”× ×©×œ×˜ $Z$ ${CZ}$ × ×™×ª×Ÿ ×œ×›×ª×™×‘×” ×›-
$$
{CZ} {|{x_1}\rangle}{|{y_1}\rangle}{x_1} = (-1)^{x_1 y_1} {|{x_1}\rangle}{x_1}{|{y_1}\rangle}.
$$
× ×¤×¢×™×œ ×¢× $m$ ×©×¢×¨×™ CZ, ××—×“ ×¢×œ $(x_1, y_1)$, ×•××—×“ ×¢×œ $(x_2, y_2)$, ×•×›×Ÿ ×”×œ××”, ×¢×“ $(x_m, y_m)$.
×× ×• ××›× ×™× ××•×¤×¨×˜×•×¨ ×–×” ${CZ}_{x,y}$.

$U_f = {CZ}_{x,y}$ ×”×•× ×’×¨×¡×” ×§×•×•× ×˜×™×ª ×©×œ ${f} = {f}(x,y)$:
$$
%\CZ_{x,y} {|#1\rangle}{z} =
U_f {|{x}\rangle}{|{y}\rangle} = {CZ}_{x,y} {|{x}\rangle}{|{y}\rangle} = (-1)^{x \cdot y}  {|{x}\rangle}{|{y}\rangle}.
$$

×× ×• ×’× ×¦×¨×™×›×™× ×œ×××© ×”×–×–×ª ××—×¨×•×–×ª ×‘×™×˜×™×.
×× ×• ××¡×× ×™× ××ª ×”××•×¤×¨×˜×•×¨ ×¢×œ ×”×¨×©×•××” $x$ ×‘-$X^{a_1}\cdots X^{a_m}$ ×¢×œ ×™×“×™ $X_a$
×•×‘××•×¤×Ÿ ×“×•××” ×¢×œ ×”×¨×©×•××” $y$ $X_b =  X^{b_1}\cdots X^{b_m}$.
××•×¤×¨×˜×•×¨×™× ××œ×” ××™×™×©××™× $X$ ×‘×›×œ ××§×•× ×©×‘×™×˜ ×™×—×™×“ ×”×•× $1$, ×•×”-Identity $I$ ×‘×›×œ ××§×•× ×©×”×•× $0$.
××– ×™×© ×œ× ×•
$$
 X_a X_b  {|{x}\rangle}{|{y}\rangle} = {|{x+a}\rangle}{|{y+b}\rangle}.
$$

×”×§×•×¤×¡×” ×”×©×—×•×¨×” ×”×©× ×™×™×” $g$ ×××•××©×ª ×¢×œ ×™×“×™ ×”U-××•× ×™×˜×¨×™×ª $U_g$, ×”× ×™×ª×Ÿ ×¢×œ ×™×“×™
$$
%U_g {|{x}\rangle}{|{y}\rangle} = X_aX_b \CZ_{x,y} X_aX_b {|{x}\rangle}{|{y}\rangle}.
U_g = X_aX_b {CZ}_{x,y} X_aX_b.
$$
×›×“×™ ×œ×¨××•×ª ×–××ª, ×× ×• ××™×™×©××™× ××ª ×”××•×¤×¨×˜×•×¨×™× ××™××™×Ÿ ×œ×©×××œ ×¢×œ ×”××¦×‘ ${|{x}\rangle}{|{y}\rangle}$.
×ª×—×™×œ×”

$$
 X_a X_b  {|{x}\rangle}{|{y}\rangle} = {|{x+a}\rangle}{|{y+b}\rangle}.
$$

×œ××—×¨ ××›×Ÿ,
$$
  {CZ}_{x,y}  {|{x+a}\rangle}{|{y+b}\rangle} = (-1)^{(x+a)\cdot (y+b)} {|{x+a}\rangle}{|{y+b}\rangle}.
$$

×œ×‘×¡×•×£,

$$
  X^a X^b (-1)^{(x+a)\cdot (y+b)} {|{x+a}\rangle}{|{y+b}\rangle} = (-1)^{(x+a)\cdot (y+b)} {|{x}\rangle}{|{y}\rangle},
$$

×©×”×™× ××›×Ÿ ×”×’×¨×¡×” ×”×§×•×•× ×˜×™×ª ×©×œ $f(x+a, y+b)$.
#### ××œ×’×•×¨×™×ª× ×”×”×–×–×” ×”× ×¡×ª×¨×ª {#the-hidden-shift-algorithm}

×›×¢×ª × ××—×“ ××ª ×”×¤×™×¡×•×ª ×™×—×“ ×œ×¤×ª×¨×•×Ÿ ×‘×¢×™×™×ª ×”×”×–×–×” ×”× ×¡×ª×¨×ª.
×× ×• ××ª×—×™×œ×™× ×¢×œ ×™×“×™ ×™×™×©×•× Hadamards ×¢×œ ×”×¨×©×•××•×ª ×”×××•×ª×—×œ×•×ª ×œ××¦×‘ ×”××¤×¡×™× ×”×›×•×œ×œ.
$$
H^{\otimes 2m} = H^{\otimes m} \otimes H^{\otimes m} {{|{0}\rangle}^{\otimes m}}{{|{0}\rangle}^{\otimes m}} = \frac{1}{\sqrt{2^{2m}}} \sum_{x, y \in {\mathbb{Z}_2^m}} (-1)^{x \cdot y} {|{x}\rangle}{|{y}\rangle}.
$$

×œ××—×¨ ××›×Ÿ, ×× ×• ×©×•××œ×™× ××ª ×”××•×¨×§×œ $g$ ×œ×”×’×™×¢ ××œ
$$
U_g H^{\otimes 2m} {{|{0}\rangle}^{\otimes m}}{{|{0}\rangle}^{\otimes m}}
= \frac{1}{\sqrt{2^{2m}}} \sum_{x, y \in {\mathbb{Z}_2^m}} (-1)^{(x+a) \cdot (y+b)} {|{x}\rangle}{|{y}\rangle}
$$
$$
\approx \frac{1}{\sqrt{2^{2m}}} \sum_{x, y \in {\mathbb{Z}_2^m}} (-1)^{x \cdot y + x \cdot b + y \cdot a} {|{x}\rangle}{|{y}\rangle}.
$$
×‘×©×•×¨×” ×”××—×¨×•× ×”, ×”×©××˜× ×• ××ª ×’×•×¨× ×”×¤××–×” ×”×’×œ×•×‘×œ×™×ª ×”×§×‘×•×¢×” $(-1)^{a \cdot b}$,
×•××¡×× ×™× ×©×•×•×™×•×Ÿ ×¢×“ ×›×“×™ ×¤××–×” ×‘-$\approx$.
×œ××—×¨ ××›×Ÿ, ×™×™×©×•× ×”××•×¨×§×œ $f$ ××›× ×™×¡ ×’×•×¨× × ×•×¡×£ ×©×œ $(-1)^{x \cdot y}$, ×”××‘×˜×œ ××ª ×–×” ×©×›×‘×¨ ×§×™×™×.
××– ×™×© ×œ× ×•:
$$
U_f U_g H^{\otimes 2m} {{|{0}\rangle}^{\otimes m}}{{|{0}\rangle}^{\otimes m}}
\approx \frac{1}{\sqrt{2^{2m}}} \sum_{x, y \in {\mathbb{Z}_2^m}} (-1)^{x \cdot b + y \cdot a} {|{x}\rangle}{|{y}\rangle}.
$$
×”×¦×¢×“ ×”×¡×•×¤×™ ×”×•× ×™×™×©×•× ×ª××¨×ª ×”×¤×•×¨×™×™×” ×”×”×•×¤×›×™×ª, $H^{\otimes 2m} = H^{\otimes m} \otimes H^{\otimes m}$,
××” ×©××‘×™× ×œ-
$$
H^{\otimes 2m} U_f U_g  H^{\otimes 2m} {{|{0}\rangle}^{\otimes m}}{{|{0}\rangle}^{\otimes m}}
\approx {|{b}\rangle}{|{a}\rangle}.
$$
×”××¢×’×œ ×”×¡×ª×™×™×. ×‘×”×™×¢×“×¨ ×¨×¢×©, ×“×’×™××ª ×”×¨×©×•××•×ª ×”×§×•×•× ×˜×™×•×ª
×ª×—×–×™×¨ ××ª ××—×¨×•×–×•×ª ×”×‘×™×˜×™× $b, a$ ×‘×”×¡×ª×‘×¨×•×ª $1$.

×”××›×¤×œ×” ×”×¤× ×™××™×ª ×”×‘×•×œ×™×× ×™×ª ×”×™× ×“×•×’××” ×©×œ ×¤×•× ×§×¦×™×•×ª ×”× ×§×¨××•×ª bent.
×œ× × ×’×“×™×¨ ×¤×•× ×§×¦×™×•×ª bent ×›××Ÿ
××š ×¨×§ × ×¦×™×™×Ÿ ×©×”×Ÿ
"×¢××™×“×•×ª ×‘×™×•×ª×¨ ××•×œ ×”×ª×§×¤×•×ª ×”×× ×¡×•×ª ×œ× ×¦×œ ×ª×œ×•×ª ×©×œ
×”×¤×œ×˜×™× ×‘×ª×ª-××¨×—×‘ ×œ×™× ××¨×™ ×›×œ×©×”×• ×©×œ ×”×§×œ×˜×™×."
×¦×™×˜×•×˜ ×–×” ×”×•× ××”××××¨ [_Quantum algorithms for highly non-linear Boolean functions_](https://arxiv.org/abs/0811.3208), ×©× ×•×ª×Ÿ
××œ×’×•×¨×™×ª××™ ×”×–×–×” × ×¡×ª×¨×ª ×™×¢×™×œ×™× ×œ××¡×¤×¨ ××—×œ×§×•×ª ×©×œ ×¤×•× ×§×¦×™×•×ª bent.
×”××œ×’×•×¨×™×ª× ×‘××“×¨×™×š ×–×” ××•×¤×™×¢ ×‘×¡×¢×™×£ 3.1 ×©×œ ×”××××¨.

×‘××§×¨×” ×”×›×œ×œ×™ ×™×•×ª×¨, ×”××¢×’×œ ×œ××¦×™××ª ×”×–×–×” × ×¡×ª×¨×ª $s \in \mathbb{Z}^n$ ×”×•×
$$
 H^{\otimes n} U_{\tilde{f}}  H^{\otimes n} U_g  H^{\otimes n} {|{0}\rangle}^{\otimes n} = {|{s}\rangle}.
$$
 ×‘××§×¨×” ×”×›×œ×œ×™, $f$ ×•-$g$ ×”×Ÿ ×¤×•× ×§×¦×™×•×ª ×©×œ ××©×ª× ×” ×™×—×™×“.
 ×”×“×•×’××” ×©×œ× ×• ×©×œ ×”××›×¤×œ×” ×”×¤× ×™××™×ª ×”×™× ×‘×¦×•×¨×” ×–×• ×× × × ×™×— $f(x, y) \to f(z)$,
 ×›××©×¨ $z$ ×©×•×•×” ×œ×©×¨×©×•×¨ ×©×œ $x$ ×•-$y$, ×•-$s$ ×©×•×•×” ×œ×©×¨×©×•×¨
 ×©×œ $a$ ×•-$b$.
 ×”××§×¨×” ×”×›×œ×œ×™ ×“×•×¨×© ×‘×“×™×•×§ ×©× ×™ ××•×¨×§×œ×™×: ××•×¨×§×œ ××—×“ ×¢×‘×•×¨ $g$ ×•××—×“ ×¢×‘×•×¨ $\tilde{f}$,
 ×›××©×¨ ×”××—×¨×•×Ÿ ×”×•× ×¤×•× ×§×¦×™×” ×”×™×“×•×¢×” ×›_×¤×•× ×§×¦×™×” ×”×“×•××œ×™×ª_ ×©×œ ×¤×•× ×§×¦×™×™×ª ×”-bent $f$.
 ×œ×¤×•× ×§×¦×™×™×ª ×”××›×¤×œ×” ×”×¤× ×™××™×ª ×™×© ×ª×›×•× ×ª ×”××•×˜×•-×“×•××œ×™×•×ª $\tilde{f}=f$.

 ×‘××¢×’×œ ×©×œ× ×• ×œ×”×–×–×” ×”× ×¡×ª×¨×ª ×¢×œ ×”××›×¤×œ×” ×”×¤× ×™××™×ª ×”×©××˜× ×• ××ª ×©×›×‘×ª ×”-Hadamard ×”×××¦×¢×™×ª
 ×”××•×¤×™×¢×” ×‘××¢×’×œ ×œ××§×¨×” ×”×›×œ×œ×™. ×‘×¢×•×“ ×©×‘××§×¨×” ×”×›×œ×œ×™
 ×©×›×‘×” ×–×• ×”×›×¨×—×™×ª, ×—×¡×›× ×• ×‘×¢×•××§ ×”××¢×’×œ ×¢×œ ×™×“×™ ×”×©××˜×ª×”, ×‘××—×™×¨ ×©×œ ××¢×˜
 ×¢×™×‘×•×“ ×œ××—×¨ ×”××“×™×“×” ×××—×¨ ×©×”×¤×œ×˜ ×”×•× ${|{b}\rangle}{|{a}\rangle}$ ×‘××§×•× ×”×¨×¦×•×™ ${|{a}\rangle}{|{b}\rangle}$.
## ×“×¨×™×©×•×ª {#requirements}

×œ×¤× ×™ ×ª×—×™×œ×ª ××“×¨×™×š ×–×”, ×•×•×“× ×©×”×ª×§× ×ª ××ª ×”×“×‘×¨×™× ×”×‘××™×:

- Qiskit SDK ×’×¨×¡×” v2.1 ×•××¢×œ×”, ×¢× ×ª××™×›×ª [visualization](https://docs.quantum.ibm.com/api/qiskit/visualization)
- Qiskit Runtime ×’×¨×¡×” v0.41 ×•××¢×œ×” (`pip install qiskit-ibm-runtime`)
- M3 Qiskit addon ×’×¨×¡×” v3.0 (`pip install mthree`)
## ×”×’×“×¨×” {#setup}

```python
# Added by doQumentation â€” installs packages not in the Binder environment
%pip install -q mthree
```

```python
from collections.abc import Iterator, Sequence
from random import Random
from qiskit.circuit import (
    CircuitInstruction,
    QuantumCircuit,
    QuantumRegister,
    Qubit,
)
from qiskit.circuit.library import CZGate, HGate, XGate
from qiskit.transpiler.preset_passmanagers import generate_preset_pass_manager
from qiskit_ibm_runtime import QiskitRuntimeService
import timeit
import matplotlib.pyplot as plt
from qiskit_ibm_runtime import SamplerV2 as Sampler
import mthree
```

## ×©×œ×‘ 1: ××™×¤×•×™ ×§×œ×˜×™× ×§×œ××¡×™×™× ×œ×‘×¢×™×” ×§×•×•× ×˜×™×ª {#step-1-map-classical-inputs-to-a-quantum-problem}
×¨××©×™×ª, × ×›×ª×•×‘ ××ª ×”×¤×•× ×§×¦×™×•×ª ×œ×××© ××ª ×‘×¢×™×™×ª ×”×”×–×–×” ×”× ×¡×ª×¨×ª ×›-`QuantumCircuit`.

```python
def apply_hadamards(qubits: Sequence[Qubit]) -> Iterator[CircuitInstruction]:
    """Apply a Hadamard gate to every qubit."""
    for q in qubits:
        yield CircuitInstruction(HGate(), [q], [])

def apply_shift(
    qubits: Sequence[Qubit], shift: int
) -> Iterator[CircuitInstruction]:
    """Apply X gates where the bits of the shift are equal to 1."""
    for i, q in zip(range(shift.bit_length()), qubits):
        if shift >> i & 1:
            yield CircuitInstruction(XGate(), [q], [])

def oracle_f(qubits: Sequence[Qubit]) -> Iterator[CircuitInstruction]:
    """Apply the f oracle."""
    for i in range(0, len(qubits) - 1, 2):
        yield CircuitInstruction(CZGate(), [qubits[i], qubits[i + 1]])

def oracle_g(
    qubits: Sequence[Qubit], shift: int
) -> Iterator[CircuitInstruction]:
    """Apply the g oracle."""
    yield from apply_shift(qubits, shift)
    yield from oracle_f(qubits)
    yield from apply_shift(qubits, shift)

def determine_hidden_shift(
    qubits: Sequence[Qubit], shift: int
) -> Iterator[CircuitInstruction]:
    """Determine the hidden shift."""
    yield from apply_hadamards(qubits)
    yield from oracle_g(qubits, shift)
    # We omit this layer in exchange for post processing
    # yield from apply_hadamards(qubits)
    yield from oracle_f(qubits)
    yield from apply_hadamards(qubits)

def run_hidden_shift_circuit(n_qubits, rng):
    hidden_shift = rng.getrandbits(n_qubits)

    qubits = QuantumRegister(n_qubits, name="q")
    circuit = QuantumCircuit.from_instructions(
        determine_hidden_shift(qubits, hidden_shift), qubits=qubits
    )
    circuit.measure_all()
    # Format the hidden shift as a string.
    hidden_shift_string = format(hidden_shift, f"0{n_qubits}b")
    return (circuit, hidden_shift, hidden_shift_string)

def display_circuit(circuit):
    return circuit.remove_final_measurements(inplace=False).draw(
        "mpl", idle_wires=False, scale=0.5, fold=-1
    )
```

× ×ª×—×™×œ ×¢× ×“×•×’××” ×§×˜× ×”:

```python
n_qubits = 6
random_seed = 12345
rng = Random(random_seed)
circuit, hidden_shift, hidden_shift_string = run_hidden_shift_circuit(
    n_qubits, rng
)

print(f"Hidden shift string {hidden_shift_string}")

display_circuit(circuit)
```

```text
Hidden shift string 011010
```

![Output of the previous code cell](/docs/images/tutorials/readout-error-mitigation-sampler/extracted-outputs/8297843e-00c3-4bb5-9d33-a7e558d1698c-1.avif)

## ×©×œ×‘ 2: ××•×¤×˜×™××™×–×¦×™×” ×©×œ ××¢×’×œ×™× ×œ×”×¨×¦×” ×¢×œ ×—×•××¨×ª ×§×•×•× ×˜×•× {#step-2-optimize-circuits-for-quantum-hardware-execution}

```python
job_tags = [
    f"shift {hidden_shift_string}",
    f"n_qubits {n_qubits}",
    f"seed = {random_seed}",
]
job_tags
```

```text
['shift 011010', 'n_qubits 6', 'seed = 12345']
```

```python
# Uncomment this to run the circuits on a quantum computer on IBMCloud.
service = QiskitRuntimeService()
backend = service.least_busy(
    operational=True, simulator=False, min_num_qubits=100
)

# from qiskit_ibm_runtime.fake_provider import FakeMelbourneV2
# backend = FakeMelbourneV2()
# backend.refresh(service)

print(f"Using backend {backend.name}")

def get_isa_circuit(circuit, backend):
    pass_manager = generate_preset_pass_manager(
        optimization_level=3, backend=backend, seed_transpiler=1234
    )
    isa_circuit = pass_manager.run(circuit)
    return isa_circuit

isa_circuit = get_isa_circuit(circuit, backend)
display_circuit(isa_circuit)
```

```text
Using backend ibm_kingston
```

![Output of the previous code cell](/docs/images/tutorials/readout-error-mitigation-sampler/extracted-outputs/f2b77d93-c34a-43a4-b436-e7a25024a94a-1.avif)

## ×©×œ×‘ 3: ×”×¨×¦×ª ××¢×’×œ×™× ×‘×××¦×¢×•×ª ×¤×¨×™××™×˜×™×‘×™× ×©×œ Qiskit {#step-3-execute-circuits-using-qiskit-primitives}

```python
# submit job for solving the hidden shift problem using the Sampler primitive
NUM_SHOTS = 50_000

def run_sampler(backend, isa_circuit, num_shots):
    sampler = Sampler(mode=backend)
    sampler.options.environment.job_tags
    pubs = [(isa_circuit, None, NUM_SHOTS)]
    job = sampler.run(pubs)
    return job

def setup_mthree_mitigation(isa_circuit, backend):
    # retrieve the final qubit mapping so mthree knows which qubits to calibrate
    qubit_mapping = mthree.utils.final_measurement_mapping(isa_circuit)

    # submit jobs for readout error calibration
    mit = mthree.M3Mitigation(backend)
    mit.cals_from_system(qubit_mapping, rep_delay=None)

    return mit, qubit_mapping
```

```python
job = run_sampler(backend, isa_circuit, NUM_SHOTS)
mit, qubit_mapping = setup_mthree_mitigation(isa_circuit, backend)
```

## ×©×œ×‘ 4: ×¢×™×‘×•×“ ×œ××—×¨ ×‘×™×¦×•×¢ ×•×”×—×–×¨×ª ×ª×•×¦××•×ª ×‘×¤×•×¨××˜ ×§×œ××¡×™ {#step-4-post-process-and-return-results-in-classical-format}

×‘×“×™×•×Ÿ ×”×ª×™××•×¨×˜×™ ×œ×¢×™×œ, ×§×‘×¢× ×• ×©×¢×‘×•×¨ ×§×œ×˜ $ab$, ×× ×• ××¦×¤×™× ×œ×§×‘×œ ×¤×œ×˜ $ba$.
×¡×™×‘×•×š × ×•×¡×£ ×”×•× ×©×›×“×™ ×œ×§×‘×œ ××¢×’×œ ×¤×©×•×˜ ×™×•×ª×¨ (×œ×¤× ×™ transpilation), ×”×•×¡×¤× ×• ×©×¢×¨×™ CZ × ×“×¨×©×™× ×‘×™×Ÿ
×–×•×’×•×ª ×©×›× ×™× ×©×œ Qubits. ×¤×¢×•×œ×” ×–×• ×©×§×•×œ×” ×œ×¡×™×¨×•×’ (interleaving) ××—×¨×•×–×•×ª ×”×‘×™×˜×™× $a$ ×•-$b$ ×›×š: $a1 b1 a2 b2 \ldots$.
××—×¨×•×–×ª ×”×¤×œ×˜ $ba$ ×ª×”×™×” ××¡×•×¨×’×ª ×‘××•×¤×Ÿ ×“×•××”: $b1 a1 b2 a2 \ldots$. ×”×¤×•× ×§×¦×™×” `unscramble` ×©×œ×”×œ×Ÿ
×××™×¨×” ××ª ××—×¨×•×–×ª ×”×¤×œ×˜ ×-$b1 a1 b2 a2 \ldots$ ×œ-$a1 b1 a2 b2 \ldots$, ×›×š ×©× ×™×ª×Ÿ ×œ×”×©×•×•×ª ×™×©×™×¨×•×ª ×‘×™×Ÿ ××—×¨×•×–×•×ª ×”×§×œ×˜ ×•×”×¤×œ×˜.

```python
# retrieve bitstring counts
def get_bitstring_counts(job):
    result = job.result()
    pub_result = result[0]
    counts = pub_result.data.meas.get_counts()
    return counts, pub_result
```

```python
counts, pub_result = get_bitstring_counts(job)
```

××¨×—×§ ×”-Hamming ×‘×™×Ÿ ×©×ª×™ ××—×¨×•×–×•×ª ×‘×™×˜×™× ×”×•× ××¡×¤×¨ ×”××™×§×•××™× ×©×‘×”× ×”×‘×™×˜×™× ×©×•× ×™× ×–×” ××–×”.

```python
def hamming_distance(s1, s2):
    weight = 0
    for c1, c2 in zip(s1, s2):
        (c1, c2) = (int(c1), int(c2))
        if (c1 == 1 and c2 == 1) or (c1 == 0 and c2 == 0):
            weight += 1

    return weight
```

```python
# Replace string of form a1b1a2b2... with b1a1b2a1...
# That is, reverse order of successive pairs of bits.
def unscramble(bitstring):
    ps = [bitstring[i : i + 2][::-1] for i in range(0, len(bitstring), 2)]
    return "".join(ps)

def find_hidden_shift_bitstring(counts, hidden_shift_string):
    # convert counts to probabilities
    probs = {
        unscramble(bitstring): count / NUM_SHOTS
        for bitstring, count in counts.items()
    }

    # Retrieve the most probable bitstring.
    most_probable = max(probs, key=lambda x: probs[x])

    print(f"Expected hidden shift string: {hidden_shift_string}")
    if most_probable == hidden_shift_string:
        print("Most probable bitstring matches hidden shift ğŸ˜Š.")
    else:
        print("Most probable bitstring didn't match hidden shift â˜¹ï¸.")
    print("Top 10 bitstrings and their probabilities:")
    display(
        {
            k: (v, hamming_distance(hidden_shift_string, k))
            for k, v in sorted(
                probs.items(), key=lambda x: x[1], reverse=True
            )[:10]
        }
    )

    return probs, most_probable
```

```python
probs, most_probable = find_hidden_shift_bitstring(
    counts, hidden_shift_string
)
```

```text
Expected hidden shift string: 011010
Most probable bitstring matches hidden shift ğŸ˜Š.
Top 10 bitstrings and their probabilities:
```

```text
{'011010': (0.9743, 6),
 '001010': (0.00812, 5),
 '010010': (0.0063, 5),
 '011000': (0.00554, 5),
 '011011': (0.00492, 5),
 '011110': (0.00044, 5),
 '001000': (0.00012, 4),
 '010000': (8e-05, 4),
 '001011': (6e-05, 4),
 '000010': (6e-05, 4)}
```

× ×¨×©×•× ××ª ×”×”×¡×ª×‘×¨×•×ª ×©×œ ××—×¨×•×–×ª ×”×‘×™×˜×™× ×”×¡×‘×™×¨×” ×‘×™×•×ª×¨ ×œ×¤× ×™ ×™×™×©×•× ×ª×™×§×•×Ÿ ×©×’×™××•×ª ×”×§×¨×™××” ×‘×××¦×¢×•×ª M3.

```python
max_probability_before_M3 = probs[most_probable]
max_probability_before_M3
```

```text
0.9743
```

×›×¢×ª × ×—×™×œ ××ª ×ª×™×§×•×Ÿ ×”×§×¨×™××” ×©× ×œ××“ ×¢×œ ×™×“×™ M3 ×¢×œ ×”×¡×¤×™×¨×•×ª.
×”×¤×•× ×§×¦×™×” `apply_corrections` ××—×–×™×¨×” ×”×ª×¤×œ×’×•×ª ××¢×™×Ÿ-×”×¡×ª×‘×¨×•×ª×™×ª (quasi-probability distribution). ×–×•×”×™ ×¨×©×™××” ×©×œ ××•×‘×™×™×§×˜×™ `float` ×©×¡×›×•×× ×”×•× $1$, ××š ×—×œ×§ ××”×¢×¨×›×™× ×¢×©×•×™×™× ×œ×”×™×•×ª ×©×œ×™×œ×™×™×.

```python
def perform_mitigation(mit, counts, qubit_mapping):
    # mitigate readout error
    quasis = mit.apply_correction(counts, qubit_mapping)

    # print results
    most_probable_after_m3 = unscramble(max(quasis, key=lambda x: quasis[x]))

    is_hidden_shift_identified = most_probable_after_m3 == hidden_shift_string
    if is_hidden_shift_identified:
        print("Most probable bitstring matches hidden shift ğŸ˜Š.")
    else:
        print("Most probable bitstring didn't match hidden shift â˜¹ï¸.")
    print("Top 10 bitstrings and their quasi-probabilities:")
    topten = {
        unscramble(k): f"{v:.2e}"
        for k, v in sorted(quasis.items(), key=lambda x: x[1], reverse=True)[
            :10
        ]
    }
    max_probability_after_M3 = float(topten[most_probable_after_m3])
    display(topten)

    return max_probability_after_M3, is_hidden_shift_identified
```

```python
print(f"Expected hidden shift string: {hidden_shift_string}")
max_probability_after_M3, is_hidden_shift_identified = perform_mitigation(
    mit, counts, qubit_mapping
)
```

```text
Expected hidden shift string: 011010
Most probable bitstring matches hidden shift ğŸ˜Š.
Top 10 bitstrings and their quasi-probabilities:
```

```text
{'011010': '1.01e+00',
 '001010': '8.75e-04',
 '001000': '7.38e-05',
 '010000': '4.51e-05',
 '111000': '2.18e-05',
 '001011': '1.74e-05',
 '000010': '6.42e-06',
 '011001': '-7.18e-06',
 '011000': '-4.53e-04',
 '010010': '-1.28e-03'}
```

#### ×”×©×•×•××” ×‘×™×Ÿ ×–×™×”×•×™ ××—×¨×•×–×ª ×”-hidden shift ×œ×¤× ×™ ×•××—×¨×™ ×ª×™×§×•×Ÿ M3 {#compare-identifying-the-hidden-shift-string-before-and-after-applying-m3-correction}

```python
def compare_before_and_after_M3(
    max_probability_before_M3,
    max_probability_after_M3,
    is_hidden_shift_identified,
):
    is_probability_improved = (
        max_probability_after_M3 > max_probability_before_M3
    )
    print(f"Most probable probability before M3: {max_probability_before_M3}")
    print(f"Most probable probability after M3: {max_probability_after_M3}")
    if is_hidden_shift_identified and is_probability_improved:
        print("Readout error mitigation effective! ğŸ˜Š")
    else:
        print("Readout error mitigation not effective. â˜¹ï¸")
```

```python
compare_before_and_after_M3(
    max_probability_before_M3,
    max_probability_after_M3,
    is_hidden_shift_identified,
)
```

```text
Most probable probability before M3: 0.9743
Most probable probability after M3: 1.01
Readout error mitigation effective! ğŸ˜Š
```

### ×›×™×¦×“ ×–××Ÿ ×”-CPU ×”× ×“×¨×© ×¢×œ ×™×“×™ M3 ××©×ª× ×” ×¢× ××¡×¤×¨ ×”×™×¨×•×™×•×ª {#plot-how-cpu-time-required-by-m3-scales-with-shots}

```python
# Collect samples for numbers of shots varying from 5000 to 25000.
shots_range = range(5000, NUM_SHOTS + 1, 2500)
times = []
for shots in shots_range:
    print(f"Applying M3 correction to {shots} shots...")
    t0 = timeit.default_timer()
    _ = mit.apply_correction(
        pub_result.data.meas.slice_shots(range(shots)).get_counts(),
        qubit_mapping,
    )
    t1 = timeit.default_timer()
    print(f"\tDone in {t1 - t0} seconds.")
    times.append(t1 - t0)

fig, ax = plt.subplots()
ax.plot(shots_range, times, "o--")
ax.set_xlabel("Shots")
ax.set_ylabel("Time (s)")
ax.set_title("Time to apply M3 correction")
```

```text
Applying M3 correction to 5000 shots...
	Done in 0.003321983851492405 seconds.
Applying M3 correction to 7500 shots...
	Done in 0.004425413906574249 seconds.
Applying M3 correction to 10000 shots...
	Done in 0.006366567220538855 seconds.
Applying M3 correction to 12500 shots...
	Done in 0.0071477219462394714 seconds.
Applying M3 correction to 15000 shots...
	Done in 0.00860048783943057 seconds.
Applying M3 correction to 17500 shots...
	Done in 0.010026784148067236 seconds.
Applying M3 correction to 20000 shots...
	Done in 0.011459112167358398 seconds.
Applying M3 correction to 22500 shots...
	Done in 0.012727141845971346 seconds.
Applying M3 correction to 25000 shots...
	Done in 0.01406092382967472 seconds.
Applying M3 correction to 27500 shots...
	Done in 0.01546052098274231 seconds.
Applying M3 correction to 30000 shots...
	Done in 0.016769016161561012 seconds.
Applying M3 correction to 32500 shots...
	Done in 0.019537431187927723 seconds.
Applying M3 correction to 35000 shots...
	Done in 0.019739801064133644 seconds.
Applying M3 correction to 37500 shots...
	Done in 0.021093040239065886 seconds.
Applying M3 correction to 40000 shots...
	Done in 0.022840639110654593 seconds.
Applying M3 correction to 42500 shots...
	Done in 0.023974396288394928 seconds.
Applying M3 correction to 45000 shots...
	Done in 0.026412792038172483 seconds.
Applying M3 correction to 47500 shots...
	Done in 0.026364430785179138 seconds.
Applying M3 correction to 50000 shots...
	Done in 0.02820305060595274 seconds.
```

```text
Text(0.5, 1.0, 'Time to apply M3 correction')
```

![Output of the previous code cell](/docs/images/tutorials/readout-error-mitigation-sampler/extracted-outputs/33addc38-f738-48ed-a29d-9790f446c036-2.avif)

#### ×¤×¨×©× ×•×ª ×”×’×¨×£ {#interpreting-the-plot}

×”×’×¨×£ ×œ×¢×™×œ ××¨××” ×©×”×–××Ÿ ×”× ×“×¨×© ×œ×”×—×œ×ª ×ª×™×§×•×Ÿ M3 ×’×“×œ ×‘××•×¤×Ÿ ×œ×™× ×™××¨×™ ×¢× ××¡×¤×¨ ×”×™×¨×•×™×•×ª.

## ×”×¨×—×‘×ª ×”×’×•×“×œ {#scaling-up}

```python
n_qubits = 80
rng = Random(12345)
circuit, hidden_shift, hidden_shift_string = run_hidden_shift_circuit(
    n_qubits, rng
)

print(f"Hidden shift string {hidden_shift_string}")
```

```text
Hidden shift string 00000010100110101011101110010001010000110011101001101010101001111001100110000111
```

```python
isa_circuit = get_isa_circuit(circuit, backend)
```

```python
job = run_sampler(backend, isa_circuit, NUM_SHOTS)
mit, qubit_mapping = setup_mthree_mitigation(isa_circuit, backend)
```

```python
counts, pub_result = get_bitstring_counts(job)
```

```python
probs, most_probable = find_hidden_shift_bitstring(
    counts, hidden_shift_string
)
```

```text
Expected hidden shift string: 00000010100110101011101110010001010000110011101001101010101001111001100110000111
Most probable bitstring matches hidden shift ğŸ˜Š.
Top 10 bitstrings and their probabilities:
```

```text
{'00000010100110101011101110010001010000110011101001101010101001111001100110000111': (0.50402,
  80),
 '00000010100110101011101110010001010000110011100001101010101001111001100110000111': (0.0396,
  79),
 '00000010100110101011101110010001010000110011101001101010101001111001100100000111': (0.0323,
  79),
 '00000010100110101011101110010001010000110011101001101010101001101001100110000111': (0.01936,
  79),
 '00000010100110101011101110010011010000110011101001101010101001111001100110000111': (0.01432,
  79),
 '00000010100110101011101110010001010000110011101001101010101001011001100110000111': (0.0101,
  79),
 '00000010100110101011101110010001010000110011101001101010101001110001100110000111': (0.00924,
  79),
 '00000010100110101011101110010001010000010011101001101010101001111001100110000111': (0.00908,
  79),
 '00000010100110101011100110010001010000110011101001101010101001111001100110000111': (0.00888,
  79),
 '00000010100110101011101110010001010000110011101001100010101001111001100110000111': (0.0082,
  79)}
```

×× ×• ×¨×•××™× ×©××—×¨×•×–×ª ×”-hidden shift ×”× ×›×•× ×” ××›×Ÿ × ××¦××ª. ×™×ª×¨×” ××›×š, ×ª×©×¢ ××—×¨×•×–×•×ª ×”×‘×™×˜×™× ×”×‘××•×ª ×‘×¡×‘×™×¨×•×ª×Ÿ ×’×‘×•×”×•×ª ×©×’×•×™×•×ª ×¨×§ ×‘××™×§×•× ××—×“.
× ×¨×©×•× ××ª ×”×”×¡×ª×‘×¨×•×ª ×”×’×‘×•×”×” ×‘×™×•×ª×¨:

```python
max_probability_before_M3 = probs[most_probable]
max_probability_before_M3
```

```text
0.50402
```

```python
print(f"Expected hidden shift string: {hidden_shift_string}")
max_probability_after_M3, is_hidden_shift_identified = perform_mitigation(
    mit, counts, qubit_mapping
)
```

```text
Expected hidden shift string: 00000010100110101011101110010001010000110011101001101010101001111001100110000111
Most probable bitstring matches hidden shift ğŸ˜Š.
Top 10 bitstrings and their quasi-probabilities:
```

```text
{'00000010100110101011101110010001010000110011101001101010101001111001100110000111': '9.85e-01',
 '00000010100110101011101110010001010000110011100001101010101001111001100110000111': '6.84e-03',
 '00000010100110101011100110010001010000110011101001101010101001111001100110000111': '3.87e-03',
 '00000010100110101011101110010011010000110011101001101010101001111001100110000111': '3.42e-03',
 '00000010100110101011101110010001010000110011101001101010101001111001100100000111': '3.30e-03',
 '00000010100110101011101110010001010000110011101001101010101001110001100110000111': '3.28e-03',
 '00000010100010101011101110010001010000110011101001101010101001111001100110000111': '2.62e-03',
 '00000010100110101011101110010001010000110011101001101010101001101001100110000111': '2.43e-03',
 '00000010100110101011101110010000010000110011101001101010101001111001100110000111': '1.73e-03',
 '00000010100110101011101110010001010000110011101001101010101001111001000110000111': '1.63e-03'}
```

```python
compare_before_and_after_M3(
    max_probability_before_M3,
    max_probability_after_M3,
    is_hidden_shift_identified,
)
```

```text
Most probable probability before M3: 0.54348
Most probable probability after M3: 0.99
Readout error mitigation effective! ğŸ˜Š
```
